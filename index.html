<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AR SOLAR SYSTEM</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@100;300;700;900&family=Share+Tech+Mono&display=swap');
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --cyan:#00eeff;--cyan2:rgba(0,238,255,0.25);--warn:#ff5500;--ok:#00ff99;
  --bg:rgba(0,8,24,0.88);
}
html,body{width:100%;height:100%;overflow:hidden;background:#000;font-family:'Share Tech Mono',monospace}
#three-canvas{position:fixed;inset:0;z-index:1;}
#video{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;transform:scaleX(-1);z-index:0;opacity:0;transition:opacity 1.2s}
#video.on{opacity:.55}
#hand-canvas{position:fixed;inset:0;z-index:3;pointer-events:none;transform:scaleX(-1)}
body::after{content:'';position:fixed;inset:0;z-index:5;pointer-events:none;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px)}
#hud{position:fixed;inset:0;z-index:10;pointer-events:none}
.crn{position:absolute;width:52px;height:52px;border-color:var(--cyan);border-style:solid;opacity:.5}
.tl{top:14px;left:14px;border-width:2px 0 0 2px}.tr{top:14px;right:14px;border-width:2px 2px 0 0}
.bl{bottom:14px;left:14px;border-width:0 0 2px 2px}.br{bottom:14px;right:14px;border-width:0 2px 2px 0}
#topbar{position:absolute;top:0;left:0;right:0;padding:18px 80px;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(to bottom,rgba(0,5,20,.95) 0%,transparent 100%)}
#logo{font-family:'Exo 2',sans-serif;font-weight:900;letter-spacing:.5em;font-size:clamp(11px,2vw,17px);color:var(--cyan);text-shadow:0 0 24px rgba(0,238,255,.7);text-transform:uppercase}
#logo span{opacity:.4;font-weight:100}
#pills{display:flex;gap:12px}
.pill{font-size:8px;letter-spacing:.15em;padding:4px 10px;border:1px solid var(--cyan2);color:var(--cyan2);display:flex;align-items:center;gap:5px;transition:all .3s}
.pill.on{border-color:var(--ok);color:var(--ok)}.pill.warn{border-color:var(--warn);color:var(--warn)}
.dot{width:5px;height:5px;border-radius:50%;background:currentColor;animation:blink 1.2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.15}}
#gestures{position:absolute;top:50%;right:18px;transform:translateY(-50%);display:flex;flex-direction:column;gap:7px}
.gst{font-size:9px;letter-spacing:.08em;color:var(--cyan2);display:flex;align-items:center;gap:8px;padding:7px 10px;border:1px solid rgba(0,238,255,.1);background:rgba(0,8,24,.6);transition:all .25s}
.gst.active{color:var(--cyan);border-color:rgba(0,238,255,.5);background:rgba(0,238,255,.07)}
.gi{font-size:18px;min-width:22px;text-align:center}
#pinfo{position:absolute;left:18px;top:50%;transform:translateY(-50%);width:210px;background:var(--bg);border:1px solid var(--cyan2);backdrop-filter:blur(14px);padding:16px;opacity:0;transition:opacity .4s;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px))}
#pinfo.show{opacity:1}
#pinfo .pname{font-family:'Exo 2',sans-serif;font-weight:900;font-size:16px;letter-spacing:.2em;color:var(--cyan);text-transform:uppercase;margin-bottom:10px}
#pinfo .prow{font-size:9px;letter-spacing:.1em;color:rgba(255,255,255,.55);padding:4px 0;border-bottom:1px solid rgba(0,238,255,.08);display:flex;justify-content:space-between}
#pinfo .prow span{color:rgba(255,255,255,.9)}
#btmbar{position:absolute;bottom:0;left:0;right:0;padding:16px 80px;background:linear-gradient(to top,rgba(0,5,20,.9) 0%,transparent 100%);display:flex;justify-content:space-between;align-items:flex-end}
#controls{display:flex;gap:8px;flex-wrap:wrap;pointer-events:auto}
.btn{font-family:'Exo 2',sans-serif;font-weight:700;font-size:9px;letter-spacing:.18em;padding:8px 14px;border:1px solid var(--cyan2);background:rgba(0,8,24,.7);color:var(--cyan2);cursor:pointer;transition:all .2s;text-transform:uppercase;clip-path:polygon(5px 0%,100% 0%,calc(100% - 5px) 100%,0% 100%)}
.btn:hover,.btn.on{border-color:var(--cyan);color:var(--cyan);background:rgba(0,238,255,.1);box-shadow:0 0 16px rgba(0,238,255,.2)}
#cam-tip{font-size:9px;letter-spacing:.1em;color:rgba(255,255,255,.3)}
#gflash{position:fixed;inset:0;z-index:50;pointer-events:none;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s}
#gflash-text{font-family:'Exo 2',sans-serif;font-weight:900;font-size:clamp(20px,5vw,40px);letter-spacing:.4em;color:var(--cyan);text-shadow:0 0 40px rgba(0,238,255,.9);text-transform:uppercase}
#reticle{position:fixed;z-index:6;pointer-events:none;width:40px;height:40px;transform:translate(-50%,-50%);opacity:0;transition:opacity .3s}
#splash{position:fixed;inset:0;z-index:200;background:#000010;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;transition:opacity .8s}
#splash.gone{opacity:0;pointer-events:none}
#splash h1{font-family:'Exo 2',sans-serif;font-weight:900;letter-spacing:.5em;font-size:clamp(18px,4vw,36px);color:var(--cyan);text-shadow:0 0 40px rgba(0,238,255,.6)}
#splash p{font-size:11px;letter-spacing:.25em;color:rgba(255,255,255,.4)}
#progress-bar{width:260px;height:2px;background:rgba(0,238,255,.15);overflow:hidden}
#progress-fill{height:100%;background:var(--cyan);width:0%;transition:width .4s;box-shadow:0 0 12px var(--cyan)}
#splash-status{font-size:10px;letter-spacing:.2em;color:rgba(0,238,255,.6)}
.splash-btn{font-family:'Exo 2',sans-serif;font-weight:700;font-size:11px;letter-spacing:.2em;padding:12px 28px;cursor:pointer;text-transform:uppercase;transition:all .2s;pointer-events:auto}
#btn-cam{border:1px solid var(--cyan);background:transparent;color:var(--cyan)}
#btn-cam:hover{background:rgba(0,238,255,.12);box-shadow:0 0 24px rgba(0,238,255,.3)}
#btn-skip{border:1px solid rgba(255,255,255,.2);background:transparent;color:rgba(255,255,255,.4);margin-top:-8px}
#btn-skip:hover{color:rgba(255,255,255,.7);border-color:rgba(255,255,255,.4)}
</style>
</head>
<body>
<video id="video" playsinline autoplay muted></video>
<canvas id="three-canvas"></canvas>
<canvas id="hand-canvas"></canvas>
<div id="reticle"><svg viewBox="0 0 40 40" fill="none" width="40" height="40"><circle cx="20" cy="20" r="8" stroke="#00eeff" stroke-width="1" opacity=".7"/><line x1="20" y1="2" x2="20" y2="12" stroke="#00eeff" stroke-width="1" opacity=".7"/><line x1="20" y1="28" x2="20" y2="38" stroke="#00eeff" stroke-width="1" opacity=".7"/><line x1="2" y1="20" x2="12" y2="20" stroke="#00eeff" stroke-width="1" opacity=".7"/><line x1="28" y1="20" x2="38" y2="20" stroke="#00eeff" stroke-width="1" opacity=".7"/></svg></div>
<div id="gflash"><div id="gflash-text"></div></div>
<div id="hud">
  <div class="crn tl"></div><div class="crn tr"></div><div class="crn bl"></div><div class="crn br"></div>
  <div id="topbar">
    <div id="logo">AR <span>Â·</span> SOLAR SYSTEM <span>Â·</span> UNIVERSE</div>
    <div id="pills">
      <div class="pill warn" id="cam-pill"><div class="dot"></div>CAMERA OFF</div>
      <div class="pill" id="hand-pill"><div class="dot"></div>HANDS: STANDBY</div>
      <div class="pill on"><div class="dot"></div>SYSTEM ONLINE</div>
    </div>
  </div>
  <div id="gestures">
    <div class="gst" id="g-pinch"><span class="gi">ğŸ¤Œ</span>PINCH â€” ZOOM</div>
    <div class="gst" id="g-grab"><span class="gi">âœŠ</span>FIST â€” ROTATE</div>
    <div class="gst" id="g-point"><span class="gi">â˜ï¸</span>POINT â€” SELECT</div>
    <div class="gst" id="g-open"><span class="gi">ğŸ–ï¸</span>OPEN â€” TILT</div>
    <div class="gst" id="g-swipe"><span class="gi">ğŸ‘‹</span>SWIPE â€” NEXT</div>
  </div>
  <div id="pinfo">
    <div class="pname" id="pname">â€”</div>
    <div class="prow">Diameter <span id="p-dia">â€”</span></div>
    <div class="prow">Dist. from Sun <span id="p-dist">â€”</span></div>
    <div class="prow">Orbital Period <span id="p-orb">â€”</span></div>
    <div class="prow">Rotation <span id="p-rot">â€”</span></div>
    <div class="prow">Moons <span id="p-moons">â€”</span></div>
    <div class="prow">Avg Temp <span id="p-temp">â€”</span></div>
  </div>
  <div id="btmbar">
    <div id="controls">
      <button class="btn on" onclick="toggleAR()" id="btn-ar">â¬¤ AR MODE</button>
      <button class="btn on" onclick="toggleOrbits()" id="btn-orbits">â—¯ ORBITS</button>
      <button class="btn on" onclick="toggleLabels()" id="btn-labels">âŸ LABELS</button>
      <button class="btn" onclick="togglePause()" id="btn-pause">â¸ PAUSE</button>
      <button class="btn" onclick="resetCamera()">âŒ– RESET</button>
      <button class="btn" onclick="toggleSpeed()" id="btn-speed">âš¡ Ã—1</button>
    </div>
    <div id="cam-tip">DRAG TO ROTATE Â· SCROLL TO ZOOM Â· CLICK PLANET TO SELECT</div>
  </div>
</div>
<div id="splash">
  <h1>SOLAR SYSTEM</h1>
  <p>AUGMENTED REALITY Â· 3D UNIVERSE Â· GESTURE CONTROL</p>
  <div id="progress-bar"><div id="progress-fill"></div></div>
  <p id="splash-status">INITIALIZING...</p>
  <button class="splash-btn" id="btn-cam" onclick="initCamera()">â¬¤ ENABLE CAMERA &amp; LAUNCH</button>
  <button class="splash-btn" id="btn-skip" onclick="launch()">LAUNCH WITHOUT CAMERA</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// â”€â”€ SEEDED RNG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mkRng(seed){
  var s=seed>>>0;
  return function(){s^=s<<13;s^=s>>17;s^=s<<5;return(s>>>0)/4294967296;};
}

// â”€â”€ PLANET DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var PLANETS=[
  {name:'Mercury',radius:.22,dist:5,  speed:4.15,tilt:.03,  info:{dia:'4,879 km',  dist:'57.9M km', orb:'88 days',  rot:'58.6 days',moons:'0',  temp:'167Â°C'}},
  {name:'Venus',  radius:.50,dist:7.5,speed:1.62,tilt:177,  info:{dia:'12,104 km', dist:'108.2M km',orb:'225 days', rot:'243 days', moons:'0',  temp:'464Â°C'}},
  {name:'Earth',  radius:.52,dist:10.5,speed:1.0,tilt:23.4, info:{dia:'12,742 km', dist:'149.6M km',orb:'365 days', rot:'24 hrs',   moons:'1',  temp:'15Â°C'}},
  {name:'Mars',   radius:.30,dist:14.5,speed:.53, tilt:25.2, info:{dia:'6,779 km',  dist:'227.9M km',orb:'687 days', rot:'24.6 hrs', moons:'2',  temp:'-65Â°C'}},
  {name:'Jupiter',radius:1.3,dist:21,  speed:.084,tilt:3.1,  info:{dia:'139,820 km',dist:'778.5M km',orb:'11.9 yrs', rot:'10 hrs',   moons:'95', temp:'-110Â°C'}},
  {name:'Saturn', radius:1.1,dist:29,  speed:.034,tilt:26.7, info:{dia:'116,460 km',dist:'1.43B km', orb:'29.5 yrs', rot:'10.7 hrs', moons:'146',temp:'-140Â°C'}},
  {name:'Uranus', radius:.75,dist:36,  speed:.012,tilt:97.8, info:{dia:'50,724 km', dist:'2.87B km', orb:'84 yrs',   rot:'17.2 hrs', moons:'27', temp:'-195Â°C'}},
  {name:'Neptune',radius:.72,dist:43,  speed:.006,tilt:28.3, info:{dia:'49,244 km', dist:'4.5B km',  orb:'165 yrs',  rot:'16.1 hrs', moons:'16', temp:'-200Â°C'}}
];

// â”€â”€ THREE.JS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var canvas3d=document.getElementById('three-canvas');
var renderer=new THREE.WebGLRenderer({canvas:canvas3d,antialias:true});
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled=true;

var scene=new THREE.Scene();
var camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,2000);
camera.position.set(0,22,60);

// SPACE BACKGROUND â€” deep blue-black sphere interior
var bgC=document.createElement('canvas');bgC.width=2;bgC.height=512;
var bgX=bgC.getContext('2d');
var bgG=bgX.createLinearGradient(0,0,0,512);
bgG.addColorStop(0,'#00020f');bgG.addColorStop(.4,'#000814');bgG.addColorStop(1,'#000204');
bgX.fillStyle=bgG;bgX.fillRect(0,0,2,512);
var bgMesh=new THREE.Mesh(
  new THREE.SphereGeometry(900,16,16),
  new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(bgC),side:THREE.BackSide})
);
scene.add(bgMesh);

window.addEventListener('resize',function(){
  renderer.setSize(window.innerWidth,window.innerHeight);
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  hCanvas.width=window.innerWidth;hCanvas.height=window.innerHeight;
});

// â”€â”€ LIGHTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
scene.add(new THREE.AmbientLight(0x112244,.5));
var sunLight=new THREE.PointLight(0xfff5dd,6,600);
scene.add(sunLight);
var dl=new THREE.DirectionalLight(0x334488,.2);
dl.position.set(-50,30,-50);scene.add(dl);

// â”€â”€ CANVAS HELPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mkC(w,h){var c=document.createElement('canvas');c.width=w;c.height=h;return c;}

// â”€â”€ TEXTURE GENERATORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mkMercuryTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(1001);
  var g=x.createRadialGradient(sz*.45,sz*.42,0,sz*.5,sz*.5,sz*.7);
  g.addColorStop(0,'#a89880');g.addColorStop(.5,'#7a6858');g.addColorStop(1,'#4a3c32');
  x.fillStyle=g;x.fillRect(0,0,sz,sz);
  for(var i=0;i<140;i++){
    var cx=r()*sz,cy=r()*sz,cr=2+r()*28;
    var cg=x.createRadialGradient(cx-cr*.25,cy-cr*.25,0,cx,cy,cr);
    cg.addColorStop(0,'rgba(38,26,20,.75)');cg.addColorStop(.65,'rgba(58,42,34,.4)');cg.addColorStop(1,'transparent');
    x.fillStyle=cg;x.beginPath();x.arc(cx,cy,cr,0,Math.PI*2);x.fill();
    x.beginPath();x.arc(cx,cy,cr,0,Math.PI*2);
    x.strokeStyle='rgba(190,170,148,'+(0.08+r()*.14)+')';x.lineWidth=1+r()*2;x.stroke();
    if(cr>14){x.beginPath();x.arc(cx,cy,cr*.12,0,Math.PI*2);x.fillStyle='rgba(160,140,118,.35)';x.fill();}
  }
  x.globalAlpha=.06;
  var rcx=sz*.33,rcy=sz*.26;
  for(var i=0;i<14;i++){
    var a=r()*Math.PI*2,l=r()*sz*.42;
    x.beginPath();x.moveTo(rcx,rcy);x.lineTo(rcx+Math.cos(a)*l,rcy+Math.sin(a)*l);
    x.strokeStyle='#c8b8a0';x.lineWidth=2+r()*4;x.stroke();
  }
  x.globalAlpha=.18;
  for(var i=0;i<2500;i++){
    x.fillStyle=r()>.5?'rgba(255,240,220,.25)':'rgba(0,0,0,.35)';
    x.fillRect(r()*sz,r()*sz,1+r()*2,1+r()*2);
  }
  x.globalAlpha=1;
  return new THREE.CanvasTexture(c);
}
function mkVenusTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(2002);
  x.fillStyle='#c8a040';x.fillRect(0,0,sz,sz);
  for(var i=0;i<30;i++){
    var y=r()*sz,h=18+r()*65;
    var g=x.createLinearGradient(0,y,0,y+h);
    var rv=Math.floor(200+r()*55),gv=Math.floor(130+r()*60),bv=Math.floor(30+r()*40);
    g.addColorStop(0,'rgba('+rv+','+gv+','+bv+',0)');
    g.addColorStop(.35,'rgba('+rv+','+gv+','+bv+','+(0.28+r()*.38)+')');
    g.addColorStop(1,'rgba('+rv+','+gv+','+bv+',0)');
    x.fillStyle=g;x.fillRect(0,y,sz,h);
  }
  x.globalAlpha=.25;
  for(var i=0;i<18;i++){
    var cx=r()*sz,cy=r()*sz,cr=35+r()*90;
    var hg=x.createRadialGradient(cx,cy,0,cx,cy,cr);
    hg.addColorStop(0,'rgba(255,195,90,.4)');hg.addColorStop(1,'transparent');
    x.fillStyle=hg;x.beginPath();x.ellipse(cx,cy,cr,cr*.38,r()*Math.PI,0,Math.PI*2);x.fill();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkEarthTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(3003);
  x.fillStyle='#0d3a6e';x.fillRect(0,0,sz,sz);
  var og=x.createLinearGradient(0,0,sz,sz);
  og.addColorStop(0,'rgba(0,40,100,.45)');og.addColorStop(1,'rgba(5,50,110,.35)');
  x.fillStyle=og;x.fillRect(0,0,sz,sz);
  var lands=[
    [[.13,.18],[.27,.16],[.34,.22],[.31,.36],[.23,.42],[.16,.48],[.10,.43],[.07,.33],[.09,.23]],
    [[.21,.47],[.27,.45],[.31,.50],[.29,.61],[.25,.70],[.19,.68],[.17,.57],[.19,.49]],
    [[.47,.16],[.63,.13],[.80,.16],[.92,.21],[.97,.29],[.94,.37],[.83,.41],[.70,.44],[.58,.39],[.50,.33],[.45,.26]],
    [[.49,.33],[.59,.31],[.65,.38],[.63,.54],[.58,.64],[.50,.67],[.44,.59],[.42,.47],[.44,.36]],
    [[.74,.54],[.86,.52],[.91,.58],[.89,.67],[.80,.70],[.73,.64],[.71,.57]],
    [[.21,.10],[.29,.08],[.33,.14],[.31,.21],[.25,.23],[.19,.18]],
  ];
  lands.forEach(function(pts){
    x.beginPath();x.moveTo(pts[0][0]*sz,pts[0][1]*sz);
    pts.forEach(function(p){x.lineTo(p[0]*sz,p[1]*sz);});x.closePath();
    x.fillStyle='#4a7830';x.fill();
  });
  x.globalAlpha=.88;
  var iN=x.createLinearGradient(0,0,0,sz*.12);
  iN.addColorStop(0,'#e8f4ff');iN.addColorStop(.7,'rgba(220,240,255,.65)');iN.addColorStop(1,'transparent');
  x.fillStyle=iN;x.fillRect(0,0,sz,sz*.11);
  var iS=x.createLinearGradient(0,sz*.88,0,sz);
  iS.addColorStop(0,'transparent');iS.addColorStop(.3,'rgba(220,240,255,.75)');iS.addColorStop(1,'#e8f4ff');
  x.fillStyle=iS;x.fillRect(0,sz*.88,sz,sz*.12);
  x.globalAlpha=.42;
  for(var i=0;i<38;i++){
    var px=r()*sz,py=r()*sz,cr=22+r()*75,str=1+r()*2.2;
    var cg=x.createRadialGradient(px,py,0,px,py,cr);
    cg.addColorStop(0,'rgba(255,255,255,.85)');cg.addColorStop(.45,'rgba(255,255,255,.3)');cg.addColorStop(1,'transparent');
    x.fillStyle=cg;x.save();x.scale(str,1);x.beginPath();x.arc(px/str,py,cr,0,Math.PI*2);x.fill();x.restore();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkMarsTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(4004);
  var g=x.createLinearGradient(0,0,sz,sz);
  g.addColorStop(0,'#c4420c');g.addColorStop(.4,'#9e2e08');g.addColorStop(.7,'#c84e1a');g.addColorStop(1,'#882600');
  x.fillStyle=g;x.fillRect(0,0,sz,sz);
  x.globalAlpha=.65;
  var vg=x.createLinearGradient(0,sz*.42,0,sz*.56);
  vg.addColorStop(0,'transparent');vg.addColorStop(.3,'rgba(35,8,0,.8)');vg.addColorStop(.7,'rgba(35,8,0,.6)');vg.addColorStop(1,'transparent');
  x.fillStyle=vg;x.save();x.transform(1,0,-.28,1,sz*.25,0);x.fillRect(0,sz*.43,sz*.55,sz*.1);x.restore();
  x.globalAlpha=.82;
  var pN=x.createLinearGradient(0,0,0,sz*.14);
  pN.addColorStop(0,'#ffe4d0');pN.addColorStop(.7,'rgba(255,215,190,.65)');pN.addColorStop(1,'transparent');
  x.fillStyle=pN;x.fillRect(0,0,sz,sz*.14);
  var pS=x.createLinearGradient(0,sz*.88,0,sz);
  pS.addColorStop(0,'transparent');pS.addColorStop(.5,'rgba(255,215,190,.55)');pS.addColorStop(1,'#ffe4d0');
  x.fillStyle=pS;x.fillRect(0,sz*.88,sz,sz*.12);
  x.globalAlpha=.55;
  for(var i=0;i<90;i++){
    var cx=r()*sz,cy=r()*sz,cr=2+r()*24;
    var cg=x.createRadialGradient(cx,cy,0,cx,cy,cr);
    cg.addColorStop(0,'rgba(48,12,2,.7)');cg.addColorStop(.7,'rgba(68,20,5,.35)');cg.addColorStop(1,'transparent');
    x.fillStyle=cg;x.beginPath();x.arc(cx,cy,cr,0,Math.PI*2);x.fill();
    x.beginPath();x.arc(cx,cy,cr,0,Math.PI*2);
    x.strokeStyle='rgba(200,115,58,'+(0.12+r()*.18)+')';x.lineWidth=1.5;x.stroke();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkJupiterTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(5005);
  x.fillStyle='#c88b3a';x.fillRect(0,0,sz,sz);
  var bands=[[0,.06,'#e8c878',.92],[.06,.05,'#9a5c2a',.87],[.11,.04,'#d4a060',.92],[.15,.06,'#864018',.84],[.21,.04,'#e0b870',.92],[.25,.07,'#b06838',.87],[.32,.04,'#f0d090',.94],[.36,.06,'#8c3c18',.84],[.42,.05,'#d09050',.92],[.47,.08,'#b06838',.87],[.55,.04,'#e8c870',.92],[.59,.06,'#964820',.84],[.65,.05,'#d4a060',.92],[.70,.07,'#c08040',.87],[.77,.04,'#e0c880',.94],[.81,.06,'#9c5028',.84],[.87,.06,'#d4a860',.90],[.93,.07,'#b87040',.87]];
  bands.forEach(function(b){
    x.beginPath();x.moveTo(0,b[0]*sz);
    for(var i=0;i<=sz;i+=6){var w=Math.sin(i*.035)*5+Math.sin(i*.018)*7;x.lineTo(i,b[0]*sz+w);}
    x.lineTo(sz,(b[0]+b[1])*sz);
    for(var i=sz;i>=0;i-=6){var w=Math.sin(i*.035)*5+Math.sin(i*.018)*7;x.lineTo(i,(b[0]+b[1])*sz+w);}
    x.closePath();x.fillStyle=b[2];x.globalAlpha=b[3];x.fill();
  });
  x.globalAlpha=1;
  var gx=sz*.38,gy=sz*.545,grx=sz*.105,gry=sz*.068;
  var gg=x.createRadialGradient(gx,gy,0,gx,gy,grx);
  gg.addColorStop(0,'#7a1606');gg.addColorStop(.3,'#bf2618');gg.addColorStop(.7,'rgba(175,72,38,.55)');gg.addColorStop(1,'transparent');
  x.fillStyle=gg;x.beginPath();x.ellipse(gx,gy,grx*1.25,gry*1.25,0,0,Math.PI*2);x.fill();
  for(var ri=0;ri<4;ri++){
    x.beginPath();x.ellipse(gx+(ri%2?2:-2),gy,(1-ri/4.5)*grx,(1-ri/4.5)*gry,0,0,Math.PI*2);
    x.strokeStyle='rgba(200,70,28,'+(0.18+ri*.08)+')';x.lineWidth=2+ri;x.stroke();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkSaturnTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(6006);
  x.fillStyle='#e8d090';x.fillRect(0,0,sz,sz);
  var bands=[[0,.07,'#f2dea4',.92],[.07,.05,'#c8a660',.84],[.12,.06,'#eedea8',.90],[.18,.04,'#b88e40',.84],[.22,.07,'#f2dea4',.92],[.29,.05,'#d4b462',.87],[.34,.06,'#eedea8',.90],[.40,.05,'#c09048',.84],[.45,.08,'#f0d89c',.92],[.53,.05,'#b88838',.84],[.58,.07,'#e8d494',.90],[.65,.05,'#c8a858',.84],[.70,.08,'#f2dea4',.92],[.78,.05,'#d4b468',.87],[.83,.07,'#eedea8',.90],[.90,.10,'#c8a860',.87]];
  bands.forEach(function(b){
    x.beginPath();x.moveTo(0,b[0]*sz);
    for(var i=0;i<=sz;i+=10){var w=Math.sin(i*.025)*2.5;x.lineTo(i,b[0]*sz+w);}
    x.lineTo(sz,(b[0]+b[1])*sz);
    for(var i=sz;i>=0;i-=10){var w=Math.sin(i*.025)*2.5;x.lineTo(i,(b[0]+b[1])*sz+w);}
    x.closePath();x.fillStyle=b[2];x.globalAlpha=b[3];x.fill();
  });
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkUranusTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(7007);
  var g=x.createLinearGradient(0,0,0,sz);
  g.addColorStop(0,'#7ee8e8');g.addColorStop(.35,'#5cccd8');g.addColorStop(.65,'#8ef0f0');g.addColorStop(1,'#50c0cc');
  x.fillStyle=g;x.fillRect(0,0,sz,sz);
  x.globalAlpha=.22;
  for(var i=0;i<18;i++){
    var cx=r()*sz,cy=r()*sz,cr=42+r()*85;
    var hg=x.createRadialGradient(cx,cy,0,cx,cy,cr);
    hg.addColorStop(0,'rgba(175,255,255,.28)');hg.addColorStop(1,'transparent');
    x.fillStyle=hg;x.beginPath();x.arc(cx,cy,cr,0,Math.PI*2);x.fill();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkNeptuneTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(8008);
  var g=x.createLinearGradient(0,0,sz,sz);
  g.addColorStop(0,'#0e2ea8');g.addColorStop(.4,'#1e4cd8');g.addColorStop(.7,'#1638be');g.addColorStop(1,'#081ea0');
  x.fillStyle=g;x.fillRect(0,0,sz,sz);
  x.globalAlpha=.88;
  var ds=x.createRadialGradient(sz*.4,sz*.37,0,sz*.4,sz*.37,sz*.09);
  ds.addColorStop(0,'rgba(0,6,38,.92)');ds.addColorStop(.5,'rgba(0,14,58,.55)');ds.addColorStop(1,'transparent');
  x.fillStyle=ds;x.beginPath();x.ellipse(sz*.4,sz*.37,sz*.1,sz*.065,-.3,0,Math.PI*2);x.fill();
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkSunTex(){
  var sz=512,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(999);
  var g=x.createRadialGradient(sz*.5,sz*.5,0,sz*.5,sz*.5,sz*.5);
  g.addColorStop(0,'#ffffff');g.addColorStop(.05,'#fff8e0');g.addColorStop(.18,'#ffec50');g.addColorStop(.44,'#ffaa00');g.addColorStop(.68,'#ff6600');g.addColorStop(.88,'#cc3300');g.addColorStop(1,'#aa2200');
  x.fillStyle=g;x.fillRect(0,0,sz,sz);
  x.globalAlpha=.32;
  for(var i=0;i<220;i++){
    var px=r()*sz,py=r()*sz,cr=4+r()*28;
    var cg=x.createRadialGradient(px,py,0,px,py,cr);
    cg.addColorStop(0,'rgba(255,255,195,.6)');cg.addColorStop(.6,'rgba(255,195,48,.18)');cg.addColorStop(1,'transparent');
    x.fillStyle=cg;x.beginPath();x.arc(px,py,cr,0,Math.PI*2);x.fill();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}
function mkMoonTex(){
  var sz=256,c=mkC(sz,sz),x=c.getContext('2d'),r=mkRng(9999);
  x.fillStyle='#b0b0b0';x.fillRect(0,0,sz,sz);
  for(var i=0;i<90;i++){
    var cx=r()*sz,cy=r()*sz,cr=1.5+r()*18;
    var cg=x.createRadialGradient(cx,cy,0,cx,cy,cr);
    cg.addColorStop(0,'rgba(72,72,72,.72)');cg.addColorStop(.7,'rgba(96,96,96,.3)');cg.addColorStop(1,'transparent');
    x.fillStyle=cg;x.beginPath();x.arc(cx,cy,cr,0,Math.PI*2);x.fill();
  }
  x.globalAlpha=1;return new THREE.CanvasTexture(c);
}

// â”€â”€ STARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addStars(count,rMin,rMax,color,size){
  var geo=new THREE.BufferGeometry(),v=[];
  for(var i=0;i<count;i++){
    var dist=rMin+Math.random()*(rMax-rMin),t=Math.random()*Math.PI*2,p=Math.acos(2*Math.random()-1);
    v.push(dist*Math.sin(p)*Math.cos(t),dist*Math.sin(p)*Math.sin(t),dist*Math.cos(p));
  }
  geo.setAttribute('position',new THREE.Float32BufferAttribute(v,3));
  scene.add(new THREE.Points(geo,new THREE.PointsMaterial({color:color,size:size,sizeAttenuation:true,transparent:true,opacity:.88})));
}
addStars(5500,200,900,0xffffff,.38);
addStars(700,180,450,0x6699ff,.72);
addStars(350,180,450,0xff5599,.72);
addStars(250,180,450,0xffdd55,.65);

// â”€â”€ SUN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var sunMesh=new THREE.Mesh(new THREE.SphereGeometry(2.9,64,64),new THREE.MeshBasicMaterial({map:mkSunTex()}));
scene.add(sunMesh);
var glowC=mkC(256,256),glowX=glowC.getContext('2d');
var gg=glowX.createRadialGradient(128,128,0,128,128,128);
gg.addColorStop(0,'rgba(255,225,80,.72)');gg.addColorStop(.22,'rgba(255,155,0,.3)');gg.addColorStop(.58,'rgba(255,85,0,.07)');gg.addColorStop(1,'transparent');
glowX.fillStyle=gg;glowX.fillRect(0,0,256,256);
var sunGlow=new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(glowC),transparent:true,blending:THREE.AdditiveBlending}));
sunGlow.scale.set(24,24,1);scene.add(sunGlow);
[{r:3.4,op:.065},{r:5.0,op:.022}].forEach(function(o){
  scene.add(new THREE.Mesh(new THREE.SphereGeometry(o.r,32,32),new THREE.MeshBasicMaterial({color:0xff7700,transparent:true,opacity:o.op,side:THREE.BackSide,blending:THREE.AdditiveBlending})));
});

// â”€â”€ LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mkLabel(name){
  var c=mkC(256,56),x=c.getContext('2d');
  x.font='bold 23px "Exo 2",sans-serif';
  x.fillStyle='rgba(0,238,255,.92)';x.textAlign='center';x.textBaseline='middle';
  x.shadowColor='#00eeff';x.shadowBlur=12;x.fillText(name.toUpperCase(),128,28);
  var s=new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(c),transparent:true}));
  s.scale.set(4,1,1);return s;
}

// â”€â”€ ORBIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mkOrbit(dist){
  var pts=[];
  for(var i=0;i<=128;i++){var a=i/128*Math.PI*2;pts.push(new THREE.Vector3(Math.cos(a)*dist,0,Math.sin(a)*dist));}
  return new THREE.Line(new THREE.BufferGeometry().setFromPoints(pts),new THREE.LineBasicMaterial({color:0x00eeff,transparent:true,opacity:.11}));
}

// â”€â”€ SATURN RINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mkSaturnRings(pd){
  var inner=pd.radius*1.28,outer=pd.radius*2.62;
  var geo=new THREE.RingGeometry(inner,outer,128,8);
  var pos=geo.attributes.position,uv=geo.attributes.uv;
  for(var i=0;i<pos.count;i++){
    var v=new THREE.Vector3().fromBufferAttribute(pos,i);
    uv.setXY(i,(v.length()-inner)/(outer-inner),.5);
  }
  var rc=mkC(512,4),rx=rc.getContext('2d');
  var rg=rx.createLinearGradient(0,0,512,0);
  rg.addColorStop(0,'rgba(180,160,100,0)');rg.addColorStop(.04,'rgba(155,135,85,.48)');rg.addColorStop(.12,'rgba(178,158,98,.72)');rg.addColorStop(.20,'rgba(135,118,68,.28)');rg.addColorStop(.22,'rgba(90,75,35,.04)');rg.addColorStop(.24,'rgba(135,118,68,.28)');rg.addColorStop(.28,'rgba(222,202,132,.97)');rg.addColorStop(.44,'rgba(242,222,152,1)');rg.addColorStop(.57,'rgba(212,192,122,.92)');rg.addColorStop(.60,'rgba(75,62,28,.06)');rg.addColorStop(.63,'rgba(198,175,112,.82)');rg.addColorStop(.76,'rgba(215,192,122,.87)');rg.addColorStop(.86,'rgba(178,155,95,.62)');rg.addColorStop(.93,'rgba(138,118,68,.28)');rg.addColorStop(1,'rgba(180,160,100,0)');
  rx.fillStyle=rg;rx.fillRect(0,0,512,4);
  var m=new THREE.Mesh(geo,new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(rc),transparent:true,side:THREE.DoubleSide,depthWrite:false}));
  m.rotation.x=Math.PI/2;return m;
}
function mkUranusRings(pd){
  var inner=pd.radius*1.5,outer=pd.radius*2.0;
  var geo=new THREE.RingGeometry(inner,outer,80,2);
  var pos=geo.attributes.position,uv=geo.attributes.uv;
  for(var i=0;i<pos.count;i++){
    var v=new THREE.Vector3().fromBufferAttribute(pos,i);
    uv.setXY(i,(v.length()-inner)/(outer-inner),.5);
  }
  var rc=mkC(256,2),rx=rc.getContext('2d');
  var rg=rx.createLinearGradient(0,0,256,0);
  rg.addColorStop(0,'rgba(90,190,190,0)');rg.addColorStop(.3,'rgba(90,190,190,.32)');rg.addColorStop(.5,'rgba(75,175,175,.5)');rg.addColorStop(.7,'rgba(90,190,190,.32)');rg.addColorStop(1,'rgba(90,190,190,0)');
  rx.fillStyle=rg;rx.fillRect(0,0,256,2);
  var m=new THREE.Mesh(geo,new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(rc),transparent:true,side:THREE.DoubleSide,depthWrite:false}));
  m.rotation.x=Math.PI/2;return m;
}

// â”€â”€ BUILD PLANETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var TEX_FNS=[mkMercuryTex,mkVenusTex,mkEarthTex,mkMarsTex,mkJupiterTex,mkSaturnTex,mkUranusTex,mkNeptuneTex];
var ATM=[null,{color:0xffcc66,op:.16},{color:0x3388ff,op:.11},null,null,null,{color:0x44ddee,op:.11},{color:0x1144ee,op:.09}];
var planetMeshes=[],orbitLines=[],labels=[];
var selectedPlanet=null,showOrbits=true,showLabels=true;

PLANETS.forEach(function(pd,i){
  var tex=TEX_FNS[i]();
  var rough=['Jupiter','Saturn','Venus'].includes(pd.name)?.75:['Uranus','Neptune'].includes(pd.name)?.78:.88;
  var mat=new THREE.MeshStandardMaterial({map:tex,roughness:rough,metalness:pd.name==='Mercury'?.15:0});
  var mesh=new THREE.Mesh(new THREE.SphereGeometry(pd.radius,64,64),mat);
  mesh.castShadow=true;mesh.receiveShadow=true;
  mesh.rotation.z=THREE.MathUtils.degToRad(pd.tilt);
  mesh.userData={angle:Math.random()*Math.PI*2};
  if(ATM[i]){
    mesh.add(new THREE.Mesh(new THREE.SphereGeometry(pd.radius*1.07,32,32),
      new THREE.MeshBasicMaterial({color:ATM[i].color,transparent:true,opacity:ATM[i].op,side:THREE.BackSide,blending:THREE.AdditiveBlending})));
  }
  if(pd.name==='Saturn') mesh.add(mkSaturnRings(pd));
  else if(pd.name==='Uranus') mesh.add(mkUranusRings(pd));
  if(pd.name==='Earth'){
    var moon=new THREE.Mesh(new THREE.SphereGeometry(.13,32,32),new THREE.MeshStandardMaterial({map:mkMoonTex(),roughness:1}));
    moon.userData={isMoon:true,angle:Math.random()*Math.PI*2};
    mesh.add(moon);
  }
  var orb=mkOrbit(pd.dist);scene.add(orb);orbitLines.push(orb);
  var lbl=mkLabel(pd.name);lbl.position.y=pd.radius+1;mesh.add(lbl);labels.push(lbl);
  scene.add(mesh);planetMeshes.push(mesh);
});

// Asteroid belt
(function(){
  var geo=new THREE.BufferGeometry(),v=[],r=mkRng(7777);
  for(var i=0;i<2200;i++){
    var dist=16.5+r()*3,a=r()*Math.PI*2,h=(r()-.5)*.55;
    v.push(Math.cos(a)*dist,h,Math.sin(a)*dist);
  }
  geo.setAttribute('position',new THREE.Float32BufferAttribute(v,3));
  scene.add(new THREE.Points(geo,new THREE.PointsMaterial({color:0x998870,size:.06,sizeAttenuation:true,transparent:true,opacity:.55})));
})();

// â”€â”€ HAND CANVAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var hCanvas=document.getElementById('hand-canvas');
var hCtx=hCanvas.getContext('2d');
hCanvas.width=window.innerWidth;hCanvas.height=window.innerHeight;

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var arMode=false,paused=false,speedMult=1,gesture='none';
var pinchDist0=null,pinchZ0=null,grabStartX=null,grabStartY=null,grabRot0=null,grabElev0=null;
var targetZ=60,camRot=0,camElev=.35,prevHandX=null,swipeCooldown=0;
var clock=new THREE.Clock();

// â”€â”€ CAMERA / LAUNCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var video=document.getElementById('video');
var splash=document.getElementById('splash');
function setProgress(p,msg){document.getElementById('progress-fill').style.width=p+'%';document.getElementById('splash-status').textContent=msg;}
setProgress(10,'LOADING...');
setTimeout(function(){setProgress(35,'GENERATING TEXTURES...');},150);
setTimeout(function(){setProgress(70,'BUILDING SOLAR SYSTEM...');},400);
setTimeout(function(){setProgress(95,'READY!');},700);

function launch(){setProgress(100,'LAUNCHING...');setTimeout(function(){splash.classList.add('gone');},400);}
async function initCamera(){
  setProgress(30,'REQUESTING CAMERA...');
  try{
    var stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user',width:{ideal:1280},height:{ideal:720}},audio:false});
    video.srcObject=stream;await video.play();
    arMode=true;video.classList.add('on');
    document.getElementById('cam-pill').innerHTML='<div class="dot"></div>CAMERA ON';
    document.getElementById('cam-pill').className='pill on';
    document.getElementById('btn-ar').classList.add('on');
    loadMediaPipe();
  }catch(e){
    console.warn('Camera:',e);
    document.getElementById('cam-pill').innerHTML='<div class="dot"></div>NO CAMERA';
  }
  launch();
}

// â”€â”€ MEDIAPIPE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadMediaPipe(){
  function load(src,cb){var s=document.createElement('script');s.src=src;s.crossOrigin='anonymous';s.onload=cb;document.head.appendChild(s);}
  load('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js',function(){
    load('https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js',startHands);
  });
}
function startHands(){
  if(typeof Hands==='undefined')return;
  var hands=new Hands({locateFile:function(f){return'https://cdn.jsdelivr.net/npm/@mediapipe/hands/'+f;}});
  hands.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:.7,minTrackingConfidence:.6});
  hands.onResults(onHandResults);
  if(typeof Camera!=='undefined'){
    new Camera(video,{onFrame:async function(){await hands.send({image:video});},width:640,height:480}).start();
    document.getElementById('hand-pill').innerHTML='<div class="dot"></div>HANDS: ACTIVE';
    document.getElementById('hand-pill').className='pill on';
  }
}
var CONN=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];
var TIPS=[4,8,12,16,20];
function d2(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
function detectGesture(lms){
  var tt=lms[4],it=lms[8],mt=lms[12],rt=lms[16],pt=lms[20];
  var im=lms[5],mm=lms[9],rm=lms[13],pm=lms[17];
  var pd=d2(tt,it);
  var iUp=it.y<im.y-.05,mUp=mt.y<mm.y-.05,rUp=rt.y<rm.y-.05,pUp=pt.y<pm.y-.05;
  if(pd<.06)return'pinch';if(!iUp&&!mUp&&!rUp&&!pUp)return'fist';
  if(iUp&&!mUp&&!rUp&&!pUp)return'point';if(iUp&&mUp&&rUp&&pUp)return'open';return'none';
}
function onHandResults(results){
  hCtx.clearRect(0,0,hCanvas.width,hCanvas.height);
  if(!results.multiHandLandmarks||!results.multiHandLandmarks.length){
    gesture='none';updateGestureUI();prevHandX=null;document.getElementById('reticle').style.opacity='0';return;
  }
  var W2=hCanvas.width,H2=hCanvas.height;
  results.multiHandLandmarks.forEach(function(lms){
    CONN.forEach(function(ab){
      hCtx.beginPath();hCtx.moveTo(lms[ab[0]].x*W2,lms[ab[0]].y*H2);hCtx.lineTo(lms[ab[1]].x*W2,lms[ab[1]].y*H2);
      hCtx.strokeStyle='rgba(0,238,255,.65)';hCtx.lineWidth=2;hCtx.stroke();
    });
    lms.forEach(function(lm,i){
      var tip=TIPS.includes(i);
      hCtx.beginPath();hCtx.arc(lm.x*W2,lm.y*H2,tip?7:4,0,Math.PI*2);
      hCtx.fillStyle=tip?'rgba(0,238,255,1)':'rgba(0,238,255,.65)';hCtx.fill();
    });
  });
  var lms=results.multiHandLandmarks[0];
  gesture=detectGesture(lms);updateGestureUI();
  var it=lms[8],tt=lms[4],wr=lms[0];
  var ret=document.getElementById('reticle');
  ret.style.left=((1-it.x)*window.innerWidth)+'px';ret.style.top=(it.y*window.innerHeight)+'px';ret.style.opacity='1';
  if(gesture==='pinch'){
    if(results.multiHandLandmarks.length>=2){
      var span=d2(lms[8],results.multiHandLandmarks[1][8]);
      if(!pinchDist0){pinchDist0=span;pinchZ0=targetZ;}
      else targetZ=Math.max(6,Math.min(130,pinchZ0*(pinchDist0/Math.max(span,.01))));
    }else{var pd=d2(tt,it);if(!pinchDist0){pinchDist0=pd;pinchZ0=targetZ;}else{var delta=(pinchDist0-pd)/Math.max(pinchDist0,.01);targetZ=Math.max(6,Math.min(130,pinchZ0+delta*90));}}
  }else pinchDist0=null;
  if(gesture==='fist'){if(grabStartX===null){grabStartX=wr.x;grabStartY=wr.y;grabRot0=camRot;grabElev0=camElev;}else{camRot=grabRot0+(grabStartX-wr.x)*5;camElev=Math.max(-1.3,Math.min(1.3,grabElev0+(grabStartY-wr.y)*2.5));}}else{grabStartX=null;grabStartY=null;}
  if(gesture==='open'){if(grabStartY===null){grabStartY=wr.y;grabElev0=camElev;}else camElev=Math.max(-1.3,Math.min(1.3,grabElev0+(grabStartY-wr.y)*3));}
  swipeCooldown=Math.max(0,swipeCooldown-1);
  if((gesture==='none'||gesture==='point')&&swipeCooldown===0){
    if(prevHandX!==null){var dx=wr.x-prevHandX;if(Math.abs(dx)>.14){var dir=dx>0?1:-1;var next=selectedPlanet!==null?(selectedPlanet+dir+PLANETS.length)%PLANETS.length:0;selectedPlanet=next;showPlanetInfo(next);swipeCooldown=35;flashGesture(PLANETS[next].name.toUpperCase());}}
    prevHandX=wr.x;
  }else if(gesture==='fist'||gesture==='open')prevHandX=null;
  if(gesture==='point'&&swipeCooldown===0){
    var nx=(1-it.x)*2-1,ny=-it.y*2+1;
    var ray=new THREE.Raycaster();ray.setFromCamera(new THREE.Vector2(nx,ny),camera);
    var hits=ray.intersectObjects(planetMeshes,false);
    if(hits.length>0){var idx=planetMeshes.indexOf(hits[0].object);if(idx>=0&&idx!==selectedPlanet){selectedPlanet=idx;showPlanetInfo(idx);flashGesture(PLANETS[idx].name.toUpperCase());}}
  }
}
function updateGestureUI(){
  var m={pinch:'g-pinch',fist:'g-grab',point:'g-point',open:'g-open'};
  document.querySelectorAll('.gst').forEach(function(e){e.classList.remove('active');});
  if(m[gesture])document.getElementById(m[gesture]).classList.add('active');
}
var flashTO=null;
function flashGesture(text){
  var el=document.getElementById('gflash'),tel=document.getElementById('gflash-text');
  tel.textContent=text;el.style.opacity='1';clearTimeout(flashTO);flashTO=setTimeout(function(){el.style.opacity='0';},1200);
}
function showPlanetInfo(idx){
  var pd=PLANETS[idx];
  document.getElementById('pname').textContent=pd.name;
  document.getElementById('p-dia').textContent=pd.info.dia;
  document.getElementById('p-dist').textContent=pd.info.dist;
  document.getElementById('p-orb').textContent=pd.info.orb;
  document.getElementById('p-rot').textContent=pd.info.rot;
  document.getElementById('p-moons').textContent=pd.info.moons;
  document.getElementById('p-temp').textContent=pd.info.temp;
  document.getElementById('pinfo').classList.add('show');
}

// â”€â”€ CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAR(){arMode=!arMode;video.style.opacity=(arMode&&video.srcObject)?'.55':'0';document.getElementById('btn-ar').classList.toggle('on',arMode);}
function toggleOrbits(){showOrbits=!showOrbits;orbitLines.forEach(function(o){o.visible=showOrbits;});document.getElementById('btn-orbits').classList.toggle('on',showOrbits);}
function toggleLabels(){showLabels=!showLabels;labels.forEach(function(l){l.visible=showLabels;});document.getElementById('btn-labels').classList.toggle('on',showLabels);}
function togglePause(){paused=!paused;document.getElementById('btn-pause').textContent=paused?'â–¶ RESUME':'â¸ PAUSE';document.getElementById('btn-pause').classList.toggle('on',paused);}
function resetCamera(){targetZ=60;camRot=0;camElev=.35;selectedPlanet=null;document.getElementById('pinfo').classList.remove('show');}
var SPEEDS=[1,5,25,100],sIdx=0;
function toggleSpeed(){sIdx=(sIdx+1)%SPEEDS.length;speedMult=SPEEDS[sIdx];document.getElementById('btn-speed').textContent='âš¡ Ã—'+SPEEDS[sIdx];}

// â”€â”€ MOUSE / TOUCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var mDown=false,lmx=0,lmy=0,mMoved=false;
canvas3d.style.pointerEvents='auto';
canvas3d.addEventListener('mousedown',function(e){mDown=true;lmx=e.clientX;lmy=e.clientY;mMoved=false;});
window.addEventListener('mouseup',function(){mDown=false;});
window.addEventListener('mousemove',function(e){
  if(!mDown)return;mMoved=true;
  camRot-=(e.clientX-lmx)*.012;camElev+=(e.clientY-lmy)*.006;
  camElev=Math.max(-1.3,Math.min(1.3,camElev));lmx=e.clientX;lmy=e.clientY;
});
window.addEventListener('wheel',function(e){targetZ=Math.max(5,Math.min(140,targetZ+e.deltaY*.065));},{passive:true});
canvas3d.addEventListener('click',function(e){
  if(mMoved)return;
  var nx=(e.clientX/window.innerWidth)*2-1,ny=-(e.clientY/window.innerHeight)*2+1;
  var ray=new THREE.Raycaster();ray.setFromCamera(new THREE.Vector2(nx,ny),camera);
  var hits=ray.intersectObjects(planetMeshes,false);
  if(hits.length>0){var idx=planetMeshes.indexOf(hits[0].object);if(idx>=0){selectedPlanet=idx;showPlanetInfo(idx);flashGesture(PLANETS[idx].name.toUpperCase());}}
  else{selectedPlanet=null;document.getElementById('pinfo').classList.remove('show');}
});
var tch0=null,tch1Span=null,tZ0=null;
window.addEventListener('touchstart',function(e){
  if(e.touches.length===1)tch0={x:e.touches[0].clientX,y:e.touches[0].clientY};
  if(e.touches.length===2){var dx=e.touches[0].clientX-e.touches[1].clientX,dy=e.touches[0].clientY-e.touches[1].clientY;tch1Span=Math.hypot(dx,dy);tZ0=targetZ;}
},{passive:true});
window.addEventListener('touchmove',function(e){
  if(e.touches.length===1&&tch0){camRot-=(e.touches[0].clientX-tch0.x)*.012;camElev+=(e.touches[0].clientY-tch0.y)*.006;camElev=Math.max(-1.3,Math.min(1.3,camElev));tch0={x:e.touches[0].clientX,y:e.touches[0].clientY};}
  if(e.touches.length===2&&tch1Span){var dx=e.touches[0].clientX-e.touches[1].clientX,dy=e.touches[0].clientY-e.touches[1].clientY;var span=Math.hypot(dx,dy);targetZ=Math.max(5,Math.min(140,tZ0*tch1Span/Math.max(span,1)));}
},{passive:true});

// â”€â”€ RENDER LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animate(){
  requestAnimationFrame(animate);
  var dt=Math.min(clock.getDelta(),.05)*speedMult;
  if(!paused){
    sunMesh.rotation.y+=dt*.03;
    var sp=.985+.015*Math.sin(Date.now()*.0014);
    sunGlow.scale.set(24*sp,24*sp,1);
    planetMeshes.forEach(function(mesh,i){
      var pd=PLANETS[i];
      mesh.userData.angle+=dt*pd.speed*.1;
      mesh.position.x=Math.cos(mesh.userData.angle)*pd.dist;
      mesh.position.z=Math.sin(mesh.userData.angle)*pd.dist;
      mesh.rotation.y+=dt*(pd.name==='Venus'?-.22:.38);
      var moon=mesh.children.find(function(ch){return ch.userData&&ch.userData.isMoon;});
      if(moon){moon.userData.angle=(moon.userData.angle||0)+dt*2.2;moon.position.x=Math.cos(moon.userData.angle)*.88;moon.position.z=Math.sin(moon.userData.angle)*.88;}
      if(selectedPlanet===i){var s=1+.04*Math.sin(Date.now()*.005);mesh.scale.set(s,s,s);}
      else mesh.scale.set(1,1,1);
    });
  }
  var cz=camera.position.length();
  var sz2=cz+(targetZ-cz)*.09;
  camera.position.x=Math.sin(camRot)*sz2*Math.cos(camElev);
  camera.position.y=Math.sin(camElev)*sz2;
  camera.position.z=Math.cos(camRot)*sz2*Math.cos(camElev);
  camera.lookAt(selectedPlanet!==null?planetMeshes[selectedPlanet].position:new THREE.Vector3(0,0,0));
  labels.forEach(function(l){l.quaternion.copy(camera.quaternion);});
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
